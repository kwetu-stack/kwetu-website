<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Order {{ order['order_no'] or order['id'] }}</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;margin:24px;background:#fff;color:#111}
    .headgrid{display:grid;grid-template-columns:1.3fr 1fr;gap:16px;margin-bottom:12px}
    h1{font-size:18px;margin:0 0 8px}
    .box{border:1px solid #ccc;padding:8px;border-radius:6px}
    table{width:100%;border-collapse:collapse;margin-top:10px}
    th,td{border:1px solid #ccc;padding:8px;font-size:14px;vertical-align:top}
    th{background:#f3f4f6;text-align:left}
    .right{text-align:right}
    .meta td{border:none;padding:2px 0}
    .muted{color:#666;font-size:12px}
    .totals{margin-top:12px;display:flex;justify-content:flex-end;gap:24px}
    .totals div{min-width:200px}
    .totals .row{display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px dashed #ddd}
    .totals .row:last-child{font-weight:600;border-bottom:none}
  </style>
</head>
<body>
  <h1>ORDER</h1>

  <div class="headgrid">
    <div class="box">
      <div class="meta">
        <div><strong>Rep:</strong> {{ rep_name or '' }}</div>
        <div><strong>Customer (Ship to):</strong> {{ order['customer_name'] or '' }}</div>
        <div><strong>Location:</strong> {{ order['customer_location'] or '' }}</div>
      </div>
    </div>
    <div class="box">
      <table class="meta">
        <tr><td><strong>Order No:</strong></td><td class="right">{{ order['order_no'] or order['id'] }}</td></tr>
        <tr><td><strong>Dated:</strong></td><td class="right">{{ (order['created_at'] or '')[:10] }}</td></tr>
        <tr><td><strong>Currency:</strong></td><td class="right">{{ order['currency'] or 'KES' }}</td></tr>
      </table>
    </div>
  </div>

  <table>
    <thead>
      <tr>
        <th>Description of Goods</th>
        <th class="right">Quantity</th>
        <th class="right">Rate</th>
        <th class="right">Amount</th>
      </tr>
    </thead>
    <tbody>
      {% for it in items %}
      <tr>
        <td>{{ it.label or ('Product #' ~ (it.product_id or '')) }}</td>
        <td class="right">{{ it.qty }}</td>
        <td class="right">{{ '%.2f'|format(it.unit_price|float) }}</td>
        <td class="right">{{ '%.2f'|format(it.amount|float) }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <div class="totals">
    <div>
      {% set total = items | sum(attribute='amount', start=0) %}
      <div class="row">
        <span>Total</span>
        <span>{{ '%.2f'|format(total|float) }} {{ order['currency'] or 'KES' }}</span>
      </div>
    </div>
  </div>

  {% if order['notes'] %}
  <p class="muted"><strong>Comments / Terms:</strong> {{ order['notes'] }}</p>
  {% endif %}

  <p class="muted">Generated by SalesPro360.</p>
</body>
</html>
